{% extends "base.html" %}
{% block content %}
{% if success_message %}
<div class="success-message">
    {{ success_message }}
</div>
{% endif %}

<div id="error-message" class="error-message" style="display: none;"></div>

{% for block in blocks %}
<div class="block-section" data-block-id="{{ block['id'] }}" data-collapsed="{{ block['collapsed'] or 0 }}" data-position="{{ block['position'] or 0 }}" draggable="false">
    <div class="block-header">
        <div class="block-title-section">
            <button type="button" class="btn-small collapse-btn" data-block-id="{{ block['id'] }}" title="Collapse/Expand Block">
                <svg class="collapse-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    {% if block['collapsed'] %}
                        <path d="M19 13H13v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                    {% else %}
                        <path d="M19 13H5v-2h14v2z"/>
                    {% endif %}
                </svg>
            </button>
            <h3 class="block-title" data-block-id="{{ block['id'] }}">{{ block['name'] }}</h3>
            <input type="text" class="block-name-edit" data-block-id="{{ block['id'] }}" value="{{ block['name'] }}" style="display: none;" minlength="1" maxlength="50"/>
            
            <!-- Mobile Block Actions -->
            <div class="mobile-block-actions">
                <button class="mobile-actions-trigger" onclick="toggleMobileMenu(this)" title="Block Actions">⋮</button>
                <div class="mobile-actions-menu">
                    <div class="mobile-action-item" onclick="document.querySelector('.rename-btn[data-block-id=&quot;{{ block['id'] }}&quot;]').click()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 0.75em;">
                            <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                        </svg>
                        Rename Block
                    </div>
                    <div class="mobile-action-item danger" onclick="document.querySelector('.delete-btn[data-block-id=&quot;{{ block['id'] }}&quot;]').click()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 0.75em;">
                            <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                        </svg>
                        Delete Block
                    </div>
                </div>
            </div>
        </div>
        <div class="block-actions">
            <button type="button" class="btn-small rename-btn" data-block-id="{{ block['id'] }}" title="Rename Block">
                <svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                </svg>
            </button>
            <button type="button" class="btn-small save-btn" data-block-id="{{ block['id'] }}" style="display: none;" title="Save Changes">
                <svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                </svg>
            </button>
            <button type="button" class="btn-small cancel-btn" data-block-id="{{ block['id'] }}" style="display: none;" title="Cancel Changes">
                <svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                </svg>
            </button>
            <button type="button" class="btn-small delete-btn" data-delete-type="block" data-block-id="{{ block['id'] }}" data-delete-name="{{ block['name']|e }}" title="Delete Block">
                <svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                </svg>
            </button>
            <button type="button" class="btn-small move-up-btn" data-block-id="{{ block['id'] }}" title="Move Block Up">
                <svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/>
                </svg>
            </button>
            <button type="button" class="btn-small move-down-btn" data-block-id="{{ block['id'] }}" title="Move Block Down">
                <svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6z"/>
                </svg>
            </button>
        </div>
    </div>
    <div class="block-content" data-block-id="{{ block['id'] }}" {% if block['collapsed'] %}style="display: none;"{% endif %}>
        

        <!-- Mobile Compact Table Layout -->
        <div class="mobile-subnets">
            <table class="subnet-table mobile-table">
                <thead>
                    <tr>
                        <th>Network</th>
                        <th>VLAN</th>
                        <th>Name</th>
                        <th>⋮</th>
                    </tr>
                </thead>
                <tbody>
                    {% if block['id'] in hierarchical_networks_by_block %}
                        {% for network_entry in hierarchical_networks_by_block[block['id']] %}
                            {% if network_entry.type == 'container' %}
                                <!-- Container row mobile -->
                                <tr class="container-row mobile-container-row" data-container-id="{{ network_entry.container.id }}">
                                    <td class="container-network">
                                        <span class="expand-icon expanded" onclick="toggleContainer({{ network_entry.container.id }})">−</span>
                                        <span style="font-family: monospace; font-weight: bold;">{{ network_entry.container.base_network }}</span>
                                    </td>
                                    <td></td>
                                    <td class="container-name">
                                        <strong>{{ network_entry.container.name }}</strong>
                                        <span class="container-label">(Container)</span>
                                    </td>
                                    <td>
                                        <div class="mobile-row-actions">
                                            <button class="mobile-actions-trigger" onclick="toggleMobileMenu(this)" title="Container Actions">⋮</button>
                                            <div class="mobile-actions-menu">
                                                <div class="mobile-action-item" onclick="window.location.href='{{ url_for('segment.view_container_segment', container_id=network_entry.container.id) }}'">
                                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 0.5em;">
                                                        <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
                                                    </svg>
                                                    View Segment
                                                </div>
                                                <div class="mobile-action-item danger" onclick="if(confirm('Are you sure you want to delete container \'{{ network_entry.container.name|e }}\'?')) { deleteContainer({{ network_entry.container.id }}) }">
                                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 0.5em;">
                                                        <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                                                    </svg>
                                                    Delete Container
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                
                                <!-- Container's subnets -->
                                {% for s in network_entry.subnets %}
                                <tr class="subnet-row container-subnet mobile-container-subnet" data-container-id="{{ network_entry.container.id }}">
                                    {% if edit_id and s['id'] == edit_id|int %}
                                        <!-- Edit form for container subnet -->
                                        <td style="padding-left: 1.5em;"><input type="text" name="cidr" value="{{ s['cidr'] }}" class="subnet-input mobile-edit-input" pattern="^(?:[0-9]{1,3}\.){3}[0-9]{1,3}/[0-9]{1,2}$" title="Enter valid CIDR format (e.g., 192.168.1.0/24)" required/></td>
                                        <td><input type="number" name="vlan_id" value="{{ s['vlan_id'] }}" class="subnet-input mobile-edit-input" min="1" max="4094" title="VLAN ID must be between 1 and 4094 (optional)" /></td>
                                        <td><input type="text" name="name" value="{{ s['name'] }}" class="subnet-input mobile-edit-input" required minlength="1" maxlength="50"/></td>
                                        <td>
                                            <form method="POST" action="{{ url_for('ipam_subnets.edit_subnet', subnet_id=s['id']) }}" style="display: inline;">
                                                <input type="hidden" name="block_id" value="{{ s['block_id'] }}">
                                                <button type="submit" class="btn-small save-btn mobile-save-btn" title="Save">✓</button>
                                                <button type="button" class="btn-small cancel-btn mobile-cancel-btn" onclick="cancelEdit()" title="Cancel">✕</button>
                                            </form>
                                        </td>
                                    {% else %}
                                        <td style="padding-left: 1.5em; font-family: monospace;">{{ s['cidr'] }}</td>
                                        <td>{{ s['vlan_id'] or '-' }}</td>
                                        <td>{{ s['name'] }}</td>
                                        <td>
                                            <div class="mobile-row-actions">
                                                <button class="mobile-actions-trigger" onclick="toggleMobileMenu(this)" title="Subnet Actions">⋮</button>
                                                <div class="mobile-actions-menu">
                                                    <div class="mobile-action-item" onclick="window.location.href='{{ url_for('main.index', edit=s['id']) }}'">
                                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 0.5em;">
                                                            <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                                                        </svg>
                                                        Edit
                                                    </div>
                                                    <div class="mobile-action-item danger" data-delete-type="subnet" data-delete-id="{{ s['id'] }}" data-delete-name="{{ s['name']|e }}" data-delete-cidr="{{ s['cidr']|e }}" data-delete-vlan="{{ s['vlan_id'] }}" data-delete-block="{{ s['block_name']|e }}" onclick="showDeleteModal('subnet', '{{ s['id'] }}', '{{ s['name']|e }}', {cidr: '{{ s['cidr']|e }}', vlan: '{{ s['vlan_id'] }}', name: '{{ s['name']|e }}', block: '{{ s['block_name']|e }}'})">
                                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 0.5em;">
                                                            <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                                                        </svg>
                                                        Delete
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    {% endif %}
                                </tr>
                                {% endfor %}
                                
                            {% else %}
                                <!-- Orphaned subnet row mobile -->
                                <tr class="subnet-row mobile-subnet-row">
                                    {% set s = network_entry.subnet %}
                                    {% if edit_id and s['id'] == edit_id|int %}
                                        <!-- Edit form for orphaned subnet -->
                                        <td><input type="text" name="cidr" value="{{ s['cidr'] }}" class="subnet-input mobile-edit-input" pattern="^(?:[0-9]{1,3}\.){3}[0-9]{1,3}/[0-9]{1,2}$" title="Enter valid CIDR format (e.g., 192.168.1.0/24)" required/></td>
                                        <td><input type="number" name="vlan_id" value="{{ s['vlan_id'] }}" class="subnet-input mobile-edit-input" min="1" max="4094" title="VLAN ID must be between 1 and 4094 (optional)" /></td>
                                        <td><input type="text" name="name" value="{{ s['name'] }}" class="subnet-input mobile-edit-input" required minlength="1" maxlength="50"/></td>
                                        <td>
                                            <form method="POST" action="{{ url_for('ipam_subnets.edit_subnet', subnet_id=s['id']) }}" style="display: inline;">
                                                <input type="hidden" name="block_id" value="{{ s['block_id'] }}">
                                                <button type="submit" class="btn-small save-btn mobile-save-btn" title="Save">✓</button>
                                                <button type="button" class="btn-small cancel-btn mobile-cancel-btn" onclick="cancelEdit()" title="Cancel">✕</button>
                                            </form>
                                        </td>
                                    {% else %}
                                        <td style="font-family: monospace;">{{ s['cidr'] }}</td>
                                        <td>{{ s['vlan_id'] or '-' }}</td>
                                        <td>{{ s['name'] }}</td>
                                        <td>
                                            <div class="mobile-row-actions">
                                                <button class="mobile-actions-trigger" onclick="toggleMobileMenu(this)" title="Subnet Actions">⋮</button>
                                                <div class="mobile-actions-menu">
                                                    <div class="mobile-action-item" onclick="window.location.href='{{ url_for('main.index', edit=s['id']) }}'">
                                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 0.5em;">
                                                            <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                                                        </svg>
                                                        Edit
                                                    </div>
                                                    <div class="mobile-action-item danger" onclick="showDeleteModal('subnet', '{{ s['id'] }}', '{{ s['name']|e }}', {cidr: '{{ s['cidr']|e }}', vlan: '{{ s['vlan_id'] }}', name: '{{ s['name']|e }}', block: '{{ s['block_name']|e }}'})">
                                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 0.5em;">
                                                            <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                                                        </svg>
                                                        Delete
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    {% endif %}
                                </tr>
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                    
                    <!-- Add new subnet row -->
                    <tr class="add-subnet-row">
                        <form method="POST" action="{{ url_for('ipam_subnets.add_subnet') }}" class="mobile-add-form">
                            <td><input type="text" name="cidr" placeholder="192.168.1.0/24" class="subnet-input mobile-add-input" pattern="^(?:[0-9]{1,3}\.){3}[0-9]{1,3}/[0-9]{1,2}$" title="Enter valid CIDR format (e.g., 192.168.1.0/24)" required/></td>
                            <td><input type="number" name="vlan_id" placeholder="100" class="subnet-input mobile-add-input" min="1" max="4094" title="VLAN ID must be between 1 and 4094 (optional)" /></td>
                            <td><input type="text" name="name" placeholder="Network Name" class="subnet-input mobile-add-input" required minlength="1" maxlength="50"/></td>
                            <td>
                                <input type="hidden" name="block_id" value="{{ block['id'] }}">
                                <button type="submit" class="btn-small add-subnet-btn mobile-add-btn" title="Add Subnet">+</button>
                            </td>
                        </form>
                    </tr>
                    
                    <!-- Add new container row -->
                    <tr class="add-container-row">
                        <form method="POST" action="{{ url_for('ipam_containers.add_container_route') }}" class="mobile-add-form">
                            <input type="hidden" name="block_id" value="{{ block['id'] }}"/>
                            <td><input type="text" name="base_network" placeholder="10.0.0.0/16" class="subnet-input mobile-add-input" pattern="^(?:[0-9]{1,3}\.){3}[0-9]{1,3}/[0-9]{1,2}$" title="Enter valid CIDR format for container base network" required/></td>
                            <td></td>
                            <td><input type="text" name="container_name" placeholder="Container Name" class="subnet-input mobile-add-input" required minlength="1" maxlength="50"/></td>
                            <td>
                                <button type="submit" class="btn-small add-container-btn mobile-add-btn" title="Add Container">⊞</button>
                            </td>
                        </form>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Desktop Table Layout -->
        <table class="subnet-table">
            <tr>
                <th>Network</th>
                <th>VLAN</th>
                <th>Name</th>
                <th>Actions</th>
            </tr>
            {% if block['id'] in hierarchical_networks_by_block %}
                {% for network_entry in hierarchical_networks_by_block[block['id']] %}
                    {% if network_entry.type == 'container' %}
                        <!-- Container row -->
                        <tr class="container-row" data-container-id="{{ network_entry.container.id }}">
                            <td class="container-network">
                                <span class="expand-icon expanded" onclick="toggleContainer({{ network_entry.container.id }})">−</span>
                                {{ network_entry.container.base_network }}
                            </td>
                            <td></td>
                            <td class="container-name">
                                <strong>{{ network_entry.container.name }}</strong>
                                <span class="container-label">(Container)</span>
                            </td>
                            <td>
                                <a href="{{ url_for('segment.view_container_segment', container_id=network_entry.container.id) }}" class="btn-small segment-btn" title="View Segment">
                                    <svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
                                    </svg>
                                </a>
                                <form method="POST" action="{{ url_for('ipam_containers.delete_container_route', container_id=network_entry.container.id) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete container \'{{ network_entry.container.name|e }}\'?')">
                                            <button type="submit" class="btn-small delete-btn" title="Delete Container">
                                        <svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                                        </svg>
                                    </button>
                                </form>
                            </td>
                        </tr>
                        
                        <!-- Container's subnets (initially hidden) -->
                        {% for s in network_entry.subnets %}
                        <tr class="subnet-row container-subnet" data-container-id="{{ network_entry.container.id }}">
                            {% if edit_id and s['id'] == edit_id|int %}
                                <form method="POST" action="{{ url_for('ipam_subnets.edit_subnet', subnet_id=s['id']) }}" class="subnet-form">
                                            <td class="subnet-indented"><input type="text" name="cidr" value="{{ s['cidr'] }}" class="subnet-input" pattern="^(?:[0-9]{1,3}\.){3}[0-9]{1,3}/[0-9]{1,2}$" title="Enter valid CIDR format (e.g., 192.168.1.0/24)" required/></td>
                                    <td><input type="number" name="vlan_id" value="{{ s['vlan_id'] }}" class="subnet-input" min="1" max="4094" title="VLAN ID must be between 1 and 4094 (optional)" /></td>
                                    <td><input type="text" name="name" value="{{ s['name'] }}" class="subnet-input" required minlength="1" maxlength="50"/></td>
                                    <td>
                                        <input type="hidden" name="block_id" value="{{ s['block_id'] }}">
                                        <button type="submit" class="btn-small save-btn" title="Save Subnet">
                                            <svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                                            </svg>
                                        </button>
                                        <button type="button" class="btn-small cancel-btn" onclick="cancelEdit()" title="Cancel Edit">
                                            <svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                                            </svg>
                                        </button>
                                    </td>
                                </form>
                            {% else %}
                                <td class="subnet-indented">{{ s['cidr'] }}</td>
                                <td>{{ s['vlan_id'] }}</td>
                                <td>{{ s['name'] }}</td>
                                <td>
                                    <button type="button" class="btn-small edit-link" onclick="window.location.href='{{ url_for('main.index', edit=s['id']) }}'" title="Edit Subnet">
                                        <svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                                        </svg>
                                    </button>
                                    <button type="button" class="btn-small delete-btn" data-delete-type="subnet" data-delete-id="{{ s['id'] }}" data-delete-name="{{ s['name']|e }}" data-delete-cidr="{{ s['cidr']|e }}" data-delete-vlan="{{ s['vlan_id'] }}" data-delete-block="{{ s['block_name']|e }}" title="Delete Subnet">
                                        <svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                                        </svg>
                                    </button>
                                </td>
                            {% endif %}
                        </tr>
                        {% endfor %}
                        
                    {% else %}
                        <!-- Orphaned subnet row -->
                        <tr class="subnet-row">
                            {% set s = network_entry.subnet %}
                            {% if edit_id and s['id'] == edit_id|int %}
                                <form method="POST" action="{{ url_for('ipam_subnets.edit_subnet', subnet_id=s['id']) }}" class="subnet-form">
                                            <td><input type="text" name="cidr" value="{{ s['cidr'] }}" class="subnet-input" pattern="^(?:[0-9]{1,3}\.){3}[0-9]{1,3}/[0-9]{1,2}$" title="Enter valid CIDR format (e.g., 192.168.1.0/24)" required/></td>
                                    <td><input type="number" name="vlan_id" value="{{ s['vlan_id'] }}" class="subnet-input" min="1" max="4094" title="VLAN ID must be between 1 and 4094 (optional)" /></td>
                                    <td><input type="text" name="name" value="{{ s['name'] }}" class="subnet-input" required minlength="1" maxlength="50"/></td>
                                    <td>
                                        <input type="hidden" name="block_id" value="{{ s['block_id'] }}">
                                        <button type="submit" class="btn-small save-btn" title="Save Subnet">
                                            <svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                                            </svg>
                                        </button>
                                        <button type="button" class="btn-small cancel-btn" onclick="cancelEdit()" title="Cancel Edit">
                                            <svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                                            </svg>
                                        </button>
                                    </td>
                                </form>
                            {% else %}
                                <td>{{ s['cidr'] }}</td>
                                <td>{{ s['vlan_id'] }}</td>
                                <td>{{ s['name'] }}</td>
                                <td>
                                    <button type="button" class="btn-small edit-link" onclick="window.location.href='{{ url_for('main.index', edit=s['id']) }}'" title="Edit Subnet">
                                        <svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                                        </svg>
                                    </button>
                                    <button type="button" class="btn-small delete-btn" data-delete-type="subnet" data-delete-id="{{ s['id'] }}" data-delete-name="{{ s['name']|e }}" data-delete-cidr="{{ s['cidr']|e }}" data-delete-vlan="{{ s['vlan_id'] }}" data-delete-block="{{ s['block_name']|e }}" title="Delete Subnet">
                                        <svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                                        </svg>
                                    </button>
                                </td>
                            {% endif %}
                        </tr>
                    {% endif %}
                {% endfor %}
            {% endif %}
            <tr>
                <form method="POST" action="{{ url_for('ipam_subnets.add_subnet') }}" class="subnet-form">
                    <td><input type="text" name="cidr" placeholder="Network" class="subnet-input" pattern="^(?:[0-9]{1,3}\.){3}[0-9]{1,3}/[0-9]{1,2}$" title="Enter valid CIDR format (e.g., 192.168.1.0/24)" required/></td>
                    <td><input type="number" name="vlan_id" placeholder="VLAN" class="subnet-input" min="1" max="4094" title="VLAN ID must be between 1 and 4094 (optional)" /></td>
                    <td><input type="text" name="name" placeholder="Name" class="subnet-input" required minlength="1" maxlength="50"/></td>
                    <td>
                        <input type="hidden" name="block_id" value="{{ block['id'] }}">
                        <button type="submit" class="btn-small add-subnet-btn" title="Add Subnet">
                            <svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                            </svg>
                        </button>
                    </td>
                </form>
            </tr>
            <tr>
                <form method="POST" action="{{ url_for('ipam_containers.add_container_route') }}" class="subnet-form">
                    <input type="hidden" name="block_id" value="{{ block['id'] }}"/>
                    <td><input type="text" name="base_network" placeholder="Container Network (e.g., 10.0.0.0/16)" class="subnet-input" pattern="^(?:[0-9]{1,3}\.){3}[0-9]{1,3}/[0-9]{1,2}$" title="Enter valid CIDR format for container base network" required/></td>
                    <td></td>
                    <td><input type="text" name="container_name" placeholder="Container Name" class="subnet-input" required minlength="1" maxlength="50"/></td>
                    <td>
                        <button type="submit" class="btn-small add-container-btn" title="Add Container">
                            <svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                            </svg>
                        </button>
                        <button type="button" class="btn-small info-btn" title="What is a Container Network?">
                            <svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
                            </svg>
                            <span class="tooltip">A container network is a large IP address range (like 192.168.0.0/16) that groups related subnets together. It helps organize your networks and enables subnet planning within that address space.</span>
                        </button>
                    </td>
                </form>
            </tr>
        </table>
    </div>
    
</div>
{% endfor %}

<div class="block-section">
    <form method="POST" action="{{ url_for('ipam_blocks.add_block_route') }}" class="add-block-form">
        <div class="form-row">
            <label class="form-label">New Block Name</label>
            <input type="text" name="block_name" placeholder="Enter block name..." class="block-name-input" required minlength="1" maxlength="50"/>
        </div>
        <button type="submit" class="btn-main">Add Block</button>
    </form>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="modal-overlay" style="display: none;">
    <div id="modalContent" class="modal-content">
        <h3 id="modalTitle">Delete Confirmation</h3>
        <div id="modalMessage">
            <p>Are you sure you want to delete this item?</p>
        </div>
        <div id="modalDetails" style="display: none;">
            <table class="modal-details-table">
                <thead>
                    <tr>
                        <th>Network</th>
                        <th>VLAN</th>
                        <th>Name</th>
                    </tr>
                </thead>
                <tbody id="modalDetailsBody">
                </tbody>
            </table>
        </div>
        <div class="modal-buttons">
            <button id="modalCancelBtn" class="btn-small">Cancel</button>
            <button id="modalConfirmBtn" class="btn-small delete-btn">Delete</button>
        </div>
    </div>
</div>

    <script>
        // Store base URL for external scripts
        document.documentElement.setAttribute('data-base-url', '{{ url_for("main.index") }}');
    </script>
    <script src="{{ url_for('static', filename='js/ipam-validation.js') }}"></script>
    <script src="{{ url_for('static', filename='js/ipam-ui.js') }}"></script>
    <script src="{{ url_for('static', filename='js/ipam-management.js') }}"></script>
    <script src="{{ url_for('static', filename='js/delete-modal.js') }}"></script>
{% endblock %}