{% extends "base.html" %}

{% block title %}{{ segment.name }} - Segment Planner - Outlan IPAM{% endblock %}

{% block content %}
<!-- Block section using Outlan's existing styles -->
<div class="block-section">
    <div class="block-header">
        <div class="block-title-section">
            <button type="button" class="btn-small" onclick="window.location.href='{{ url_for('main.index') }}'" title="Back to IPAM">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                </svg>
            </button>
            <h3 class="block-title">{{ segment.name }} - Segment View</h3>
        </div>
        <div class="block-actions">
            <div class="network-info-display" style="color: var(--color-text-secondary); font-size: 0.9em; line-height: 1.4;">
                <div>Network: <strong style="font-family: monospace;">{{ segment.network }}</strong></div>
                <div>Range: <strong style="font-family: monospace;">{{ segment.ip_range }}</strong></div>
                <div id="usage-display">
                    Usage: <strong style="font-family: monospace;">{{ segment.usage.used_hosts }}/{{ segment.usage.total_hosts }} addresses 
                    ({{ "%.1f"|format(segment.usage.usage_percent) }}%)</strong>
                </div>
            </div>
        </div>
    </div>

    <div class="block-content">
        <!-- Visualization using specific class to avoid conflicts -->
        <div class="segment-visualization-container" style="margin-bottom: 20px;">
            <div class="segment-visualization-card" style="background: var(--color-bg-tertiary); border: 1px solid var(--color-border-light); border-radius: 6px; padding: 20px; margin: 0.25em 0; display: block;">
                <h4 style="margin-bottom: 15px; color: var(--color-text-primary);">Network Visualization</h4>
                <div class="network-bar" id="network-bar" style="position: relative; height: 40px; background: var(--color-bg-tertiary); border: 2px solid var(--color-border); border-radius: 6px; margin: 10px 0; overflow: hidden;"></div>
                
                <!-- Info box using existing message styling -->
                <div id="allocation-info-box" style="position: absolute; min-width: 280px; background: var(--color-bg-secondary); border: 1px solid var(--color-border); border-radius: 8px; box-shadow: 0 4px 12px var(--color-shadow-primary); z-index: 1000; opacity: 0; visibility: hidden; transform: translateY(-5px); transition: all 0.2s ease; pointer-events: none;">
                    <div class="info-header" style="display: flex; align-items: center; gap: 12px; padding: 12px 16px; border-bottom: 1px solid var(--color-border-light); background: var(--color-bg-tertiary); border-radius: 7px 7px 0 0;">
                        <div class="color-indicator" style="width: 16px; height: 16px; border-radius: 3px; border: 1px solid var(--color-border);"></div>
                        <div class="network-label" style="font-weight: 600; color: var(--color-text-primary); font-family: monospace;"></div>
                    </div>
                    <div style="padding: 12px 16px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: var(--color-text-secondary);">Description:</span>
                            <span class="description-value" style="color: var(--color-text-primary); text-align: right;"></span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: var(--color-text-secondary);">VLAN Tag:</span>
                            <span class="vlan-value" style="color: var(--color-text-primary); text-align: right;"></span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: var(--color-text-secondary);">Size:</span>
                            <span class="size-value" style="color: var(--color-text-primary); text-align: right;"></span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--color-text-secondary);">Range:</span>
                            <span class="range-value" style="color: var(--color-text-primary); text-align: right; font-family: monospace;"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Unified responsive table for subnets -->
        <div class="segment-subnets">
            <table class="subnets-table">
                <thead>
                    <tr>
                        <th>Network</th>
                        <th>VLAN</th>
                        <th>Name</th>
                        <th>Size</th>
                    </tr>
                </thead>
                <tbody id="allocations-tbody">
                    {% if segment.allocations %}
                        {% for allocation in segment.allocations %}
                        <tr>
                            <td class="network-column" style="font-family: monospace;">{{ allocation.network }}</td>
                            <td>{{ allocation.vlan_tag or '-' }}</td>
                            <td>{{ allocation.description or '-' }}</td>
                            <td class="allocation-size" data-network="{{ allocation.network }}">-</td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="4" style="text-align: center; color: var(--color-text-muted); font-style: italic; padding: 1em;">
                                No subnets found for this segment.
                            </td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>

        <!-- Note about editing -->
        <div class="success-message" style="margin-top: 20px;">
            <strong>Note:</strong> To add, edit, or delete subnets in this segment, use the main IPAM interface. 
            <a href="{{ url_for('main.index') }}" style="color: var(--color-success); text-decoration: underline;">Go back to IPAM</a>
        </div>
    </div>
</div>

<!-- Include segment data for JavaScript -->
<script type="application/json" id="segment-data">{{ segment|tojson }}</script>

<script src="{{ url_for('static', filename='js/segment-viewer.js') }}"></script>
{% endblock %}
