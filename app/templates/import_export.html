{% extends "base.html" %}
{% block content %}
<h2>Import/Export Networks</h2>

<!-- Export Section -->
<div class="card">
    <h3>Export Networks</h3>
    <p>Export your network data as a CSV file. You can choose to export all networks or select a specific block.</p>
    
    <form method="GET" action="{{ url_for('import_export.export_all_csv') }}" class="form">
        <div class="form-group">
            <label for="export_block_id" class="form-label">Block to Export (optional):</label>
            <select id="export_block_id" name="block_id" class="form-input">
                <option value="">All Blocks</option>
                {% for block in blocks %}
                <option value="{{ block.id }}">{{ block.name }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn-main export-btn">
                <svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                </svg>
                Export CSV
            </button>
        </div>
    </form>
</div>

<!-- Import Section -->
<div class="card">
    <h3>Import Networks</h3>
    <p>Import network data from a CSV file. You can download an example template to see the expected format.</p>
    
    <!-- Example CSV Download -->
    <div class="info-box">
        <p><strong>Need a template?</strong> Download the example CSV file to see the correct format and headers.</p>
        <a href="{{ url_for('import_export.download_example_csv') }}" class="btn-main">
            <svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
            </svg>
            Download Example CSV
        </a>
    </div>
    
    <form method="POST" action="{{ url_for('import_export.import_csv') }}" enctype="multipart/form-data" class="form">
        
        <div class="form-group">
            <label for="csv_file" class="form-label required">CSV File:</label>
            <input type="file" id="csv_file" name="csv_file" accept=".csv" required class="form-input">
            <div class="form-help">Select a CSV file with the format: Block, Network, VLAN, Subnet Name</div>
        </div>
        
        <div class="form-group">
            <label for="import_mode" class="form-label">Import Mode:</label>
            <select id="import_mode" name="import_mode" class="form-input" required>
                <option value="merge">Merge (Skip Existing)</option>
                <option value="override">Merge and Override (Update Existing)</option>
                <option value="replace">Complete Replace (Delete All First)</option>
            </select>
            <div class="form-help">
                <strong>Merge:</strong> Skip networks that already exist<br>
                <strong>Merge and Override:</strong> Update existing networks with new data<br>
                <strong>Complete Replace:</strong> Delete all existing data first (can be reverted by restoring a snapshot before the import)
            </div>
        </div>
        
        <div id="replace-warning" style="display: none;" class="warning-box">
            <strong>⚠️ WARNING:</strong> Complete Replace mode will delete ALL existing networks and blocks. This action cannot be undone!
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn-main import-btn">
                <svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M5 15h4v-4H7l2-3 2 3h-2v4h4V9l3 2-3 2v-2H5v4z M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"/>
                </svg>
                Import CSV
            </button>
        </div>
    </form>
</div>

<!-- Import Information -->
<div class="card">
    <h3>Import Requirements</h3>
    <ul>
        <li><strong>File Format:</strong> Must be a valid CSV file with UTF-8 encoding</li>
        <li><strong>Headers:</strong> Must contain exactly these columns: Block, Network, VLAN, Subnet Name</li>
        <li><strong>Data Validation:</strong> All network CIDRs must be valid, VLAN IDs must be 1-4094 (if specified)</li>
        <li><strong>Block Names:</strong> Blocks will be created automatically if they don't exist</li>
        <li><strong>Audit Trail:</strong> Imports create audit log entries and snapshots for data recovery</li>
    </ul>
</div>

<script src="{{ url_for('static', filename='js/import-export.js') }}"></script>
{% endblock %}
